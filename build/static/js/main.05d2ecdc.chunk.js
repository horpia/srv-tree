(this["webpackJsonpservers-infrastructure-tree"]=this["webpackJsonpservers-infrastructure-tree"]||[]).push([[0],[,,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var c=n(0),r=n(1),s=n.n(r),a=n(10),i=n.n(a),o=n(2),l=n(7),d=n.n(l),u=n(9),j=n(3),h=n(4),b=n(6),m=n(5),v=function(){function e(t){var n;Object(j.a)(this,e),this.name=void 0,this.desc=void 0,this.el=void 0,this.id=void 0,this.searchStringCache="",this.el=t,this.name=t.getAttribute("name")||"",this.desc=(null===(n=t.querySelector(":scope > desc"))||void 0===n?void 0:n.textContent)||"",this.id=(this instanceof e?this.constructor:void 0).name+":"+this.name+"@"+ ++e.sequence}return Object(h.a)(e,[{key:"getElementsTextBySelector",value:function(e){var t=[];return this.el.querySelectorAll(e).forEach((function(e){t.push(((null===e||void 0===e?void 0:e.textContent)||"").trim())})),t}},{key:"toSearchString",value:function(){return""!==this.searchStringCache||(this.searchStringCache=this.name+" "+this.desc+" "+this.getTextToSearch(),this.searchStringCache=this.searchStringCache.toLowerCase().split(" ").filter((function(e,t,n){return t===n.indexOf(e)})).join(" ").replace(/\s+/g," ").trimEnd()),this.searchStringCache}},{key:"toString",value:function(){return this.id}}]),e}();v.sequence=0;var p,O=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var c;return Object(j.a)(this,n),(c=t.call(this,e)).type=void 0,c.globalAddr=[],c.localAddr=[],c.port=void 0,c.type=e.getAttribute("type")||"service",c.port=parseInt(e.getAttribute("port")||"0",10),c.globalAddr=c.getElementsTextBySelector(":scope > global-addr"),c.localAddr=c.getElementsTextBySelector(":scope > local-addr"),c}return Object(h.a)(n,[{key:"getTextToSearch",value:function(){return this.type+" "+this.localAddr.join(",")+" "+this.globalAddr.join(",")+" "+this.port}}]),n}(v),f=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var c;return Object(j.a)(this,n),(c=t.call(this,e)).ip=[],c.globalAddr=[],c.localAddr=[],c.services=void 0,c.ip=c.getElementsTextBySelector(":scope > ip"),c.globalAddr=c.getElementsTextBySelector(":scope > global-addr"),c.localAddr=c.getElementsTextBySelector(":scope > local-addr"),c.services=[],e.querySelectorAll(":scope > service").forEach((function(e){c.services.push(new O(e))})),c}return Object(h.a)(n,[{key:"getTextToSearch",value:function(){return this.ip.join(",")+" "+this.localAddr.join(",")+" "+this.globalAddr.join(",")+" "+this.services.map((function(e){return e.toSearchString()})).join(" ")}}]),n}(v),x=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var c,r,s,a,i;return Object(j.a)(this,n),(i=t.call(this,e)).ip=[],i.globalAddr=[],i.localAddr=[],i.cpu=void 0,i.ram=void 0,i.disk=void 0,i.os=void 0,i.vms=[],i.services=[],i.ip=i.getElementsTextBySelector(":scope > ip"),i.globalAddr=i.getElementsTextBySelector(":scope > global-addr"),i.localAddr=i.getElementsTextBySelector(":scope > local-addr"),i.cpu=(null===(c=e.querySelector(":scope > cpu"))||void 0===c?void 0:c.textContent)||"",i.ram=(null===(r=e.querySelector(":scope > ram"))||void 0===r?void 0:r.textContent)||"",i.disk=(null===(s=e.querySelector(":scope > disk"))||void 0===s?void 0:s.textContent)||"",i.os=(null===(a=e.querySelector(":scope > os"))||void 0===a?void 0:a.textContent)||"",e.querySelectorAll(":scope > vm").forEach((function(e){i.vms.push(new f(e))})),e.querySelectorAll(":scope > service").forEach((function(e){i.services.push(new O(e))})),i}return Object(h.a)(n,[{key:"getTextToSearch",value:function(){return this.ip.join(",")+" "+this.localAddr.join(",")+" "+this.globalAddr.join(",")+" "+this.cpu+" "+this.os+" "+this.vms.map((function(e){return e.toSearchString()})).join(" ")+" "+this.services.map((function(e){return e.toSearchString()})).join(" ")}}]),n}(v),_=function(e){Object(b.a)(n,e);var t=Object(m.a)(n);function n(e){var c;return Object(j.a)(this,n),(c=t.call(this,e)).servers=void 0,c.servers=[],e.querySelectorAll(":scope > srv").forEach((function(e){c.servers.push(new x(e))})),c}return Object(h.a)(n,[{key:"getTextToSearch",value:function(){return this.servers.map((function(e){return e.toSearchString()})).join(" ")}}]),n}(v),g=function(){function e(){Object(j.a)(this,e),this.data=void 0,this.dataCenters=[]}return Object(h.a)(e,[{key:"loadByUrl",value:function(){var e=Object(u.a)(d.a.mark((function e(t){var n,c,r,s,a,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{cache:"no-cache"});case 2:return e.next=4,e.sent.text();case 4:return c=e.sent,this.data=(new DOMParser).parseFromString(c,"application/xml"),(r=t.split("/")).pop(),s=r.join("/"),a=[],this.data.querySelectorAll("include[src]").forEach((function(e){a.push(new Promise(function(){var t=Object(u.a)(d.a.mark((function t(n){var c,r,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=s+"/"+e.getAttribute("src"),t.next=3,fetch(c,{cache:"no-cache"});case 3:return t.next=5,t.sent.text();case 5:r=t.sent,a=(new DOMParser).parseFromString(r,"application/xml"),e.parentElement&&a.firstElementChild&&e.parentElement.replaceChild(a.firstElementChild,e),n();case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))})),e.next=13,Promise.all(a);case 13:return i=[],this.data.querySelectorAll("infra > dc").forEach((function(e){i.push(new _(e))})),(n=this.dataCenters).splice.apply(n,[0,this.dataCenters.length].concat(i)),e.abrupt("return",this);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();n(17),n(18),n(19),n(20),n(21);function N(e){return Object(c.jsxs)("div",{className:"connector connector_"+e.type,children:[Object(c.jsx)("div",{className:"connector__v-line"}),Object(c.jsxs)("div",{className:"connector__connection",children:[Object(c.jsx)("div",{className:"connector__point"}),Object(c.jsx)("div",{className:"connector__h-line",children:Object(c.jsx)("div",{className:"connector__caption",children:e.caption||S(e.ip||[])})}),e.globalAddr&&e.globalAddr.length>0?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{className:"connector__wan-point"}),Object(c.jsx)("div",{className:"connector__wan-line",children:Object(c.jsx)("div",{className:"connector__wan-caption",children:S(e.globalAddr||[])})})]}):null,e.localAddr&&e.localAddr.length>0?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{className:"connector__lan-point"}),Object(c.jsx)("div",{className:"connector__lan-line",children:Object(c.jsx)("div",{className:"connector__lan-caption",children:S(e.localAddr||[])})})]}):null]})]})}function S(e){return e.map((function(e,t){return Object(c.jsx)("div",{children:e},t.toString())}))}!function(e){e.LAN="lan",e.WAN="wan",e.VM="vm",e.ROOT_SERVICE="root-service",e.SERVICE="service"}(p||(p={}));n(22);var A=n.p+"static/media/icons.f9e07b6a.svg",E=n.p+"static/media/elasticsearch.81e26c95.svg",y=n.p+"static/media/apache.ec3db90d.svg",C=n.p+"static/media/mssql.cfe2c656.svg",T=n.p+"static/media/db2.5d89dc76.svg",w=n.p+"static/media/ruby.320ed468.svg",k=(n(23),["server","vm","data-center","service","arrow","info","cancel","php","php-fpm","nginx","redis","mysql","cassandra","rabbitmq","sphinxsearch","elasticsearch","clickhouse","docker","nodejs","kafka","cron","crontab","storage","postgresql","mariadb","oracle","mongodb","apache","mssql","db2","jenkins","consul","kibana","zabbix","ansible","graylog","vault","java","python","ruby","perl"]),R={elasticsearch:E,apache:y,mssql:C,db2:T,ruby:w};function q(e){var t=e.name.toLowerCase(),n=e.className||"";return k.includes(t)||(t="service"),"string"===typeof R[t]?Object(c.jsx)("img",{src:R[t],alt:"",className:"icon "+n}):Object(c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",className:"icon "+n,children:Object(c.jsx)("use",{href:"".concat(A,"#").concat(t)})})}var I;n(24);function V(e){return Object(c.jsx)("div",{className:"arrow-button",hidden:!!e.hidden,children:Object(c.jsx)(q,{name:"arrow",className:(e.isOpen?"icon_rot270":"icon_rot90")+" icon_sm arrow-button__icon"})})}!function(e){e[e.NONE=0]="NONE",e[e.DATA_CENTER=1]="DATA_CENTER",e[e.SERVER=2]="SERVER",e[e.VIRTUAL_MACHINE=3]="VIRTUAL_MACHINE",e[e.SERVICE=4]="SERVICE"}(I||(I={}));var L={collapseTo:I.NONE,setCollapseTo:function(e){}},M=s.a.createContext(L);function B(e){var t=Object(r.useState)(I.NONE),n=Object(o.a)(t,2),s={collapseTo:n[0],setCollapseTo:n[1]};return Object(c.jsx)(M.Provider,{value:s,children:e.children})}function H(e){var t=Object(r.useContext)(M),n=Object(r.useState)(!1),s=Object(o.a)(n,2),a=s[0],i=s[1],l=["node-label"];a&&l.push("node-label_show-info"),e.isEmpty&&l.push("node-label_empty");return Object(c.jsxs)("div",{className:l.join(" "),style:{"--lines":e.maxLines||0},children:[Object(c.jsx)("div",{className:"node-label__info",children:e.children}),Object(c.jsxs)("div",{className:"node-label__buttons-group",children:[Object(c.jsxs)("div",{className:"node-label__button",onClick:function(){e.setOpenState&&(t.collapseTo!==I.NONE&&t.setCollapseTo(I.NONE),e.setOpenState(!e.isOpen))},children:[Object(c.jsx)(q,{name:e.icon}),Object(c.jsx)(V,{isOpen:e.isOpen||!1,hidden:e.isEmpty}),Object(c.jsx)("div",{className:"node-label__name",children:e.name})]}),Object(c.jsx)("div",{className:"node-label__info-button",onClick:function(){return i(!a)},children:Object(c.jsx)(q,{name:"info"})})]}),Object(c.jsx)("div",{className:"node-label__v-line"})]})}n(25);function U(e){return Object(c.jsx)("div",{"data-search":e.searchText,className:"infra-tree-node "+e.className,children:e.children})}function D(e){var t,n,r=e.isRoot?p.ROOT_SERVICE:p.SERVICE,s=Math.max((null===(t=e.model.globalAddr)||void 0===t?void 0:t.length)||0,(null===(n=e.model.localAddr)||void 0===n?void 0:n.length)||0);return Object(c.jsxs)(U,{searchText:e.model.toSearchString(),className:"service",children:[Object(c.jsx)(N,{type:r,caption:e.model.port>0?":"+e.model.port:"",globalAddr:e.model.globalAddr,localAddr:e.model.localAddr}),Object(c.jsx)("div",{className:"service__body",children:Object(c.jsx)(H,{icon:e.model.type,name:e.model.name||e.model.type,isEmpty:!0,maxLines:s,children:e.model.desc})})]})}function P(e){var t,n,s,a=Object(r.useState)(!0),i=Object(o.a)(a,2),l=i[0],d=i[1],u=Object(r.useContext)(M);if(u.collapseTo===I.VIRTUAL_MACHINE&&l)return d(!1),null;if(u.collapseTo===I.SERVICE&&!l)return d(!0),null;var j=e.model.services.map((function(e){return Object(c.jsx)(D,{model:e},e.toString())})),h=0===j.length,b=Math.max((null===(t=e.model.ip)||void 0===t?void 0:t.length)||0,(null===(n=e.model.globalAddr)||void 0===n?void 0:n.length)||0,(null===(s=e.model.localAddr)||void 0===s?void 0:s.length)||0);return Object(c.jsxs)(U,{searchText:e.model.toSearchString(),className:"vm",children:[Object(c.jsx)(N,{type:p.VM,ip:e.model.ip,globalAddr:e.model.globalAddr,localAddr:e.model.localAddr}),Object(c.jsxs)("div",{className:"vm__body",children:[Object(c.jsx)(H,{icon:"vm",name:e.model.name,isEmpty:h,isOpen:l,setOpenState:d,maxLines:b,children:e.model.desc}),Object(c.jsx)("div",{className:"vm__services",hidden:!l,children:j})]})]})}n(26);function F(e){return Object(c.jsx)("div",{className:"properties-group",children:e.children})}function W(e){return Object(c.jsxs)("div",{className:"property",children:[Object(c.jsxs)("span",{className:"property__caption",children:[e.caption,":"]}),Object(c.jsx)("span",{className:"property__value",children:e.value})]})}function J(e){var t,n,s,a=Object(r.useState)(!0),i=Object(o.a)(a,2),l=i[0],d=i[1],u=Object(r.useContext)(M);if(u.collapseTo===I.SERVER){if(l)return d(!1),null}else if([I.VIRTUAL_MACHINE,I.SERVICE].includes(u.collapseTo)&&!l)return d(!0),null;var j=e.model.vms.map((function(e){return Object(c.jsx)(P,{model:e},e.toString())})),h=e.model.services.map((function(e){return Object(c.jsx)(D,{isRoot:!0,model:e},e.toString())})),b=0===h.length&&0===j.length,m=Math.max((null===(t=e.model.ip)||void 0===t?void 0:t.length)||0,(null===(n=e.model.globalAddr)||void 0===n?void 0:n.length)||0,(null===(s=e.model.localAddr)||void 0===s?void 0:s.length)||0);return Object(c.jsxs)(U,{searchText:e.model.toSearchString(),className:"server",children:[Object(c.jsx)(N,{type:p.LAN,ip:e.model.ip,globalAddr:e.model.globalAddr,localAddr:e.model.localAddr}),Object(c.jsxs)("div",{className:"server__body",children:[Object(c.jsxs)(H,{icon:"server",name:e.model.name,isEmpty:b,isOpen:l,setOpenState:d,maxLines:m,children:[Object(c.jsxs)(F,{children:[Object(c.jsx)(W,{caption:"CPU",value:e.model.cpu}),Object(c.jsx)(W,{caption:"RAM",value:e.model.ram}),Object(c.jsx)(W,{caption:"Disk",value:e.model.disk}),Object(c.jsx)(W,{caption:"OS",value:e.model.os})]}),Object(c.jsx)("div",{children:e.model.desc})]}),Object(c.jsxs)("div",{className:"server__content",hidden:!l,children:[h,j]})]})]})}function z(e){var t=Object(r.useState)(!0),n=Object(o.a)(t,2),s=n[0],a=n[1],i=Object(r.useContext)(M);if(i.collapseTo===I.DATA_CENTER){if(s)return a(!1),null}else if(i.collapseTo!==I.NONE&&!s)return a(!0),null;var l=0,d=e.model.servers.map((function(e){return l+=e.vms.length,Object(c.jsx)(J,{model:e},e.toString())})),u=0===d.length;return Object(c.jsxs)(U,{searchText:e.model.toSearchString(),className:"data-center",children:[Object(c.jsx)(N,{type:p.WAN}),Object(c.jsx)("div",{className:"data-center__wan-label",children:"WAN"}),Object(c.jsxs)("div",{className:"data-center__body",children:[Object(c.jsxs)(H,{icon:"data-center",name:e.model.name,isEmpty:u,isOpen:s,setOpenState:a,children:[Object(c.jsxs)(F,{children:[Object(c.jsx)(W,{caption:"Servers",value:d.length}),Object(c.jsx)(W,{caption:"VMs",value:l})]}),Object(c.jsx)("div",{children:e.model.desc})]}),Object(c.jsxs)("div",{className:"data-center__servers",hidden:!s,children:[Object(c.jsx)("div",{className:"data-center__lan-label",children:"LAN"}),d]})]})]})}n(27);function K(e){var t=Object(r.useState)([]),n=Object(o.a)(t,2),s=n[0],a=n[1];Object(r.useEffect)((function(){(new g).loadByUrl("data/data.xml").then((function(e){a(e.dataCenters)}))}),[]);var i=s.map((function(e){return Object(c.jsx)(z,{model:e},e.toString())}));return Object(c.jsxs)("div",{className:"infra-tree",children:[Object(c.jsxs)("div",{className:"infra-tree__search-stat",hidden:0===e.hiddenNodesCount,children:["Hidden nodes: ",e.hiddenNodesCount]}),Object(c.jsx)("div",{className:"infra-tree__data-centers",children:i})]})}n(28),n(29);function X(e){var t,n=Object(r.useContext)(M);return Object(c.jsxs)("div",{className:"filter-bar",children:[Object(c.jsx)("label",{className:"filter-bar__caption",htmlFor:"search-input",children:"Search: "}),Object(c.jsx)("input",{ref:function(e){return t=e},className:"filter-bar__search",id:"search-input",type:"text",autoComplete:"off",onKeyUp:function(n){return e.setHiddenNodesCount(G(t.value))},placeholder:"Name, ip, port etc..."}),Object(c.jsx)("div",{className:"filter-bar__button filter-bar__button_cancel",onClick:function(){return e.setHiddenNodesCount(G(t.value=""))},children:Object(c.jsx)(q,{name:"cancel"})}),Object(c.jsx)("label",{className:"filter-bar__caption",children:"Collapse to: "}),Object(c.jsx)("div",{className:"filter-bar__button filter-bar__button_dc",onClick:function(){n.setCollapseTo(I.DATA_CENTER)},children:Object(c.jsx)(q,{name:"data-center"})}),Object(c.jsx)("div",{className:"filter-bar__button filter-bar__button_srv",onClick:function(){n.setCollapseTo(I.SERVER)},children:Object(c.jsx)(q,{name:"server"})}),Object(c.jsx)("div",{className:"filter-bar__button filter-bar__button_vm",onClick:function(){n.setCollapseTo(I.VIRTUAL_MACHINE)},children:Object(c.jsx)(q,{name:"vm"})}),Object(c.jsx)("div",{className:"filter-bar__button filter-bar__button_service",onClick:function(){n.setCollapseTo(I.SERVICE)},children:Object(c.jsx)(q,{name:"service"})})]})}function G(e){e=e.replace(/["'[\]]/g,"").toLowerCase();var t=document.querySelectorAll(".infra-tree-node");if(""===e)return t.forEach((function(e){e.hidden=!1})),0;var n=0;return t.forEach((function(t){var c=t,r=c.dataset.search;c.hidden=!r.includes(e),c.hidden&&n++})),n}function Q(){var e=Object(r.useState)(0),t=Object(o.a)(e,2),n=t[0],s=t[1];return Object(c.jsxs)(B,{children:[Object(c.jsx)(X,{setHiddenNodesCount:s}),Object(c.jsx)(K,{hiddenNodesCount:n})]})}i.a.render(Object(c.jsx)(r.StrictMode,{children:Object(c.jsx)(Q,{})}),document.getElementById("root"))}],[[30,1,2]]]);
//# sourceMappingURL=main.05d2ecdc.chunk.js.map